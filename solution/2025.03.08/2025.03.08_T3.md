[[contest/2025.03.08/problem.pdf#page=4|problem]]

我们首先考虑线性的 DP

---
显然，若这道题是线性的，那么有 DP 设计如下
1. $dp_{i,j}$ 表示长度为 $i$ 的线性排列，末尾有 $j$ 个连续 `W` 的方案数
2. 转移：
	- 添加 `R`，即有 $dp_{i,0}=\displaystyle\sum^{k}_{j=0}dp_{i-1,j}$ 
	- 添加 `W`，即有 $dp_{i,j} = dp_{i-1,j-1}$  (当 $0<j\leq k$ 时) 
3. 边界：$dp_{1,0}=1$
4. 结果：$\displaystyle\sum^{n}_{j=0}dp_{n,j}$ 
---
进一步的，我们考虑循环的情况但不考虑重构，那么有答案处理如下：
1. $g_i$ 表示长度为 $i$ 的环的方案数（允许同构）
2. 计算：$g_i=\displaystyle\sum^{i}_{j=0}f_{i,j}\times (j+1)$，其中 $j+1$ 表示末尾 $j$ 个 `W` 的情况下首部允许 $0\le p\le j$ 个 `W` 相连
3. 结果：$g_n$
---
最后，我们考虑重构，那么有 DP 处理如下：
1. $h_i$ 表示长度为 $i$ 的环且循环周期恰好为 $i$ 的合法方案数
2. 转移：$h_i = g_i - \displaystyle\sum_{j \neq i\ \wedge\ j \mid i}h_j$，由于一个循环周期为 $i$ 的环可以由若干个 $j \mid i$ 的$h_i$ 拼接而成，因此此处需要去除
3. 结果：$\displaystyle\sum_{i \mid n}\frac{h_i}{i}$ （除以 $i$ 消除同构）




代码略，可见 [[contest/2025.03.08/std/Saber.cpp|std/Saber.cpp]]