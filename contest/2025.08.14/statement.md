# 咕咕模拟赛

（请选手务必仔细阅读本页内容）

## 一、题目概况

| 中文题目名称 | 最小公倍数 | 白兔迷宫 | 算数 | 染色球 |
| :---: | :---: | :---: | :---: | :---: |
| 英文题目名称 | lcm | rabbit | calc | color |
| 可执行文件名 | lcm | rabbit | calc | color |
| 输入文件名 | lcm.in | rabbit.in | calc.in | color.in |
| 输出文件名 | lcm.out | rabbit.out | calc.out | color.out |
| 提交文件名 | lcm.cpp | rabbit.cpp | calc.cpp | color.cpp |
| 每个测试点时限 | 4秒 | 1秒 | 2秒 | 3秒 |
| 测试点数目 | 20 | 20 | 20 | 20 |
| 每个测试点分值 | 5 | 5 | 5 | 5 |
| 内存限制 | 512MB | 512MB | 512MB | 1024MB |
| 题目类型 | 传统题 | 传统题 | 传统题 | 传统题 |

 

## 二、编译命令

| 题目名称 | lcm | rabbit | calc | color |
| :---: | :---: | :---: | :---: | :---: |
| 对于C++语言 | -o lcm lcm.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 | -o rabbit rabbit.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 | -o calc calc.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 | -o color color.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 |

 

## 三、注意事项 

1. 文件夹名、文件名(程序名和输入输出文件名)必须使用英文小写。
2. C/C++中函数main()的返回值类型必须是int,程序正常结束时的返回值必须是0。
3. 统一评测时采用的机器配置为：windows下lemon评测。
4. 请尽力优化，会收获更多的部分得分。
5. **AK 了不要大声喧哗，没AK也不要**。

# 最小公倍数(lcm)

## 题目描述

令 $(1+\sqrt{2})^n=e(n)+\sqrt{2}f(n)$，其中 $e(n),f(n)$ 都是整数，显然有 $(1-\sqrt{2})^n=e(n)-\sqrt{2}f(n)$。令 $g(n)=\operatorname{lcm}(f(1),f(2),\dots,f(n))$。

给定两个正整数 $n,p$，其中 $p$ 是质数，并且保证 $f(1),f(2),\dots,f(n)$ 在模 $p$ 意义下均不为 $0$，请计算 $\sum \limits_{i=1}^n i\times g(i)$ 模 $p$ 的值。

## 输入格式

第一行包含一个正整数 $T$，表示有 $T$ 组数据。

接下来是测试数据。每组测试数据只占一行，包含两个正整数 $n$ 和 $p$。

## 输出格式

对于每组测试数据，输出一行一个非负整数，表示这组数据的答案。

## 样例

#### 样例1输入

```
5
1 233
2 233
3 233
4 233
5 233
```

#### 样例1输出

```
1
5
35
42
121
```

## 数据范围

对于所有数据，满足：$1\leq T\leq 210$，$1\leq n\leq 10^6$，$2\leq p\leq 10^9+7$，$\sum n\leq 3\times 10^6$。

| 测试点编号 | 特殊限制 |
|:-:|:-:|
| $1\sim 6$ | $n\le 20$ |
| $7\sim 10$ | $n\le 100$ |
| $11\sim 14$ | $p=998244353$ |
| $15\sim 20$ | 无 |

# 白兔迷宫(rabbit)

## 题目描述

白兔进入了一个迷宫。迷宫是一个 $n$ 个点 $m$ 条边的有向图，图上可能有重边和自环。节点从 $1$ 到 $n$ 编号，起点为 $S$，终点为 $T$。保证从任意一个点出发都存在一条路径到达 $T$。

迷宫的每条边上有一个怪物，怪物有 01 两类。白兔有一个积分，初始为 0。每当白兔经过一条边：

* 若这条边上是一个 1 类怪物，白兔会将它击杀获得 1 的积分，并走到这条边的终点；
* 若这条边上是一个 0 类怪物，白兔会被其打晕。怪物不会把白兔打死，但是会清空白兔之前获得的所有积分，然后把白兔放在这条边的终点。

经过一条边后这条边上的怪物会刷新，所以白兔多次经过一条边会多次触发怪物的效果。

由于白兔不知道迷宫的结构，所以白兔决定随机游走，即从 $S$ 出发，每次从当前点独立等概率随机一条出边移动，触发对应边上怪物的效果并到达这条边的终点。当白兔第一次走到 $T$ 时，游走就结束了。

给出这张图的结构以及每条边上怪物的类型，定义 $X$ 表示游走完成时的积分对应的随机变量，白兔想让你帮他回答两个问题：

1. $X$ 的期望是多少；
2. $X$ 的方差是多少。

由于白兔不喜欢实数，你只需要输出其对 998244353 取模的结果。在题设条件下，容易发现答案一定是有理数，且将答案化为既约分数形式后分母不为 998244353 的倍数。

## 输入格式

从标准输入读入数据。

输入的第一行包含四个整数 $n,m,S,T$，表示迷宫的点数、边数、起点、终点。

接下来 $m$ 行，每行三个整数 $x,y,o$，表示一条 $x$ 到 $y$ 的有向边以及这条边上的怪物类型。

## 输出格式

输出到标准输出。

输出一行两个整数，第一个整数表示积分的期望，第二个整数表示积分的方差。

## 样例

#### 样例1输入

```
2 2 1 2
1 1 1
1 2 1
```

#### 样例1输出

```
2 2
```

#### 样例1解释

从 $1$ 号点出发有一个自环和一条通往 2 号点的边。每条边都有 $o=1$，因此积分就等于随机游走的步数。

对于 $x>0$，最终积分为 $x$ 当且仅当白兔先在 $1$ 号点走 $x−1$ 次自环，第 $x$ 次走到 $2$ 号点，因此积分为 $x$ 的概率为 $2^{−x}$。故期望为：

$$\sum\limits_{x=1}^{+\infty}x2^{−x}=2$$

方差为：

$$\sum\limits_{x=1}^{+\infty}(x-2)^22^{−x}=2$$

## 数据范围

对于全部数据，满足 $2\le n\le 100$，$1\le m\le n^2$，$1\le S,T,x,y\le n$，$S\neq T$，$o\in \{0,1\}$。

| 测试点编号 | 约束 |
| :---: | :---: |
| $1\sim 2$ | $o=0$ |
| $3\sim 8$ | $o=1$ |
| $9\sim 11$ | $x<y$ |
| $12\sim 14$ | $x\le y$ |
| $15\sim 20$ | 无特殊限制 |

## 评测方式

对于每个测试点，你每正确回答一个问题，可以获得该测试点 $50\%$ 的分数。

## 提示

记 $P_x$ 为 $X=x$ 的概率，则 $X$ 的期望为 $\mathbb{E}(x)=\sum\limits_{x=0}^{+\infty}xP_x$，$X$ 的方差为 $\operatorname{Var}(X)=\mathbb{E}((X-\mathbb{E}(X))^2)=\sum\limits_{x=0}^{+\infty}(x-\mathbb{E}(X))^2P_x$。

# 算数(calc)

## 题目描述

今天，生活在 14 进制世界的小 Q 学习了一种判断给定的大数是否是 9 的倍数的方法。我们以 $(1BB40)_{14} = (70812)_{10}$ 作为例子描述该方法，下面设 $b=14$，$p=9$，下面的方法中所有的运算在 $b$ 进制下进行。

1. 从低位往高位，将每个连续的 $k=2$ 位划分为一段。例子中，$(1BB40)_{b}$ 被划分为 $1 \mid BB \mid 40$ 三段。
2. 从低位往高位从 $0$ 开始给每一段编号。例子中，第 $0$ 段为 $40$，第 $1$ 段为 $BB$，第 $2$ 段为 $1$。
3. 对于第 $i$ 段计算出值 $b_i$：设第 $i$ 段在 $b$ 进制下的值为 $a_i$，如果 $i$ 为奇数则 $b_i$ 为满足 $(a_i+b_i) \equiv 0 \pmod p$ 的最小非负整数 $b_i$，如果 $i$ 为偶数则 $b_i$ 为满足 $(a_i-b_i) \equiv 0 \pmod p$ 的最小非负整数 $b_i$。例子中有 $b_0=2$，$b_1=6$，$b_2=1$。
4. 将 $b_i$ 按照**下标大的在低位，下标小的在高位**的顺序顺次拼接，形成一个 $b$ 进制数并输出。例子中输出结果为 $(261)_{b} = (477)_{10}$。容易验证 $477$ 和 $70812$ 都是 $p$ 的倍数。

可以证明上述方法输入和输出的数要么同时是 $p$ 的倍数，要么同时不是 $p$ 的倍数。而且数字的位数变少了，所以多做几次就可以得到一个很小的数，然后就可以简单地判断了。

小 Q 深深地被这个算法吸引了，所以他想给出一个 $b,p$ 不同于 $14,9$ 时的通用方法。但是他发现，当上面的方法中 $b,p$ 的取值变化时，$k$ 不一定等于 $2$：有时会是 $1$，有时会大于 $2$，有时甚至不存在满足条件的 $k$。所以对于给定的 $b, p$，小 Q 想知道在 $b$ 进制下上述方法的第一步中**正整数** $k$ 的最小值，使得无论输入如何，输入和对应的输出要么同时是 $p$ 的倍数，要么同时不是 $p$ 的倍数，或者报告这样的 $k$ 不存在。

注意 $p$ 不一定是质数。

## 输入格式

**测试点有多组测试数据，保证同一测试点下的 $p$ 相同**。输入的第一行包含两个正整数 $T,p$，分别表示该组测试点的测试数据组数与方法的 $p$ 参数。

接下来 $T$ 行每行输入一行一个整数 $b$ 表示每组测试数据的进制。保证 $2 \leq p < b \leq 10 \times p$。

**输入中的所有数字按照十进制给出。**

## 输出格式

对于每组数据输出一行，若不存在合法的 $k$ 输出 `-1`，否则输出最小的满足条件的**正整数** $k$。

## 样例

#### 样例1输入

```
2 9
14
16
```

#### 样例1输出

```
2
-1
```

## 数据范围

对于所有数据，满足：$1 \le T \le 10^5$，$2 \leq p \le 10^{15}$。

| 测试点编号 | 特殊性质 |
| :---: | :---: |
| $1\sim 3$ | $p\le 3$，$T\le 10$ |
| $4\sim 6$ | $p\le 10$，$T\le 10$ |
| $7\sim 9$ | $p\le 100$，$T\le 100$ |
| $10\sim 12$ | $p\le 10^4$，$T\le 100$ |
| $13\sim 15$ | $p\le 10^6$，$T\le 10^3$ |
| $16\sim 17$ | $p\le 10^{12}$，$T\le 10^3$ |
| $18\sim 20$ | 无 |

# 染色球(color)

## 题目描述

有 $N$ 个球，每个球编号为 $1$ 到 $N$。最初，第 $i$ 个球被涂上颜色 $A_i$。

颜色用 $1$ 到 $N$ 之间的整数表示。

你需要重复以下操作，直到所有球的颜色都相同为止：

- $N$ 个球的所有子集（包括空集）共有 $2^N$ 个，从中等概率随机选择一个集合。设选中的集合包含的球的编号按升序为 $X_1, X_2, \dots, X_K$。然后，从 $1,2,\dots,N$ 中选取 $K$ 个不同的数，得到一个排列，等概率随机选择一个排列 $P=(P_1,P_2,\dots,P_K)$。接下来，对于每个 $1\le i\le K$，将球 $X_i$ 的颜色改为 $P_i$。

请计算使所有球颜色相同所需操作次数的期望值，结果对 $998244353$ 取模。

这里，从 $(1,2,\dots,N)$ 中选取 $K$ 个不同的数得到的排列，指的是由 $K$ 个 $1$ 到 $N$ 之间互不相同的整数构成的序列。

## 输入格式。

第一行输入一个数 $N$。

第二行输入 $N$ 个数 $A_1,A_2\dots A_N$。

## 输出格式

输出一个数，表示答案。

## 样例

#### 样例1输入

```
2
1 2
```

#### 样例1输出

```
4
```

#### 样例1解释

每次选择大小为 $1$ 的集合，并且操作会一直持续，直到将未选球的颜色改为与之相同。该概率为 $\frac{2}{4}\times\frac{1}{2}=\frac{1}{4}$，因此期望操作次数为 $4$。

#### 样例2输入

```
3
1 1 1
```

#### 样例2输出

```
0
```

#### 样例3输入

```
10
3 1 4 1 5 9 2 6 5 3
```

#### 样例3输出

```
900221128
```

## 数据范围

对于所有数据：$2\le N\le 2000$，$1\le A_i\le N$。

| 测试点编号 | 特殊性质 |
| :---: | :---: |
| $1\sim 3$ | $N\le 3$ |
| $4\sim 6$ | $N\le 5$ |
| $7\sim 10$ | $N\le 10$ |
| $11\sim 15$ | $N\le 100$ |
| $16\sim 20$ | 无 |