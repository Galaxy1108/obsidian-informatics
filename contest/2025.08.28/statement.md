# 咕咕嘎嘎模拟赛

（请选手务必仔细阅读本页内容）

## 一、题目概况

| 中文题目名称 | 大魔法师 | 盗道 | Alice 和 Bob 又在玩游戏 | 简单数据结构 |
| :---: | :---: | :---: | :---: | :---: |
| 英文题目名称 | magic | thief | game | easy |
| 可执行文件名 | magic | thief | game | easy |
| 输入文件名 | magic.in | thief.in | game.in | easy.in |
| 输出文件名 | magic.out | thief.out | game.out | easy.out |
| 提交文件名 | magic.cpp | thief.cpp | game.cpp | easy.cpp |
| 每个测试点时限 | 5秒 | 2秒 | 3秒 | 3秒 |
| 测试点数目 | 20 | 20 | 20 | 20 |
| 每个测试点分值 | 5 | 5 | 5 | 5 |
| 内存限制 | 512MB | 512MB | 128~512MB | 512MB |
| 题目类型 | 传统题 | 传统题 | 传统题 | 传统题 |

 

## 二、编译命令

| 题目名称 | magic | thief | game | easy |
| :---: | :---: | :---: | :---: | :---: |
| 对于C++语言 | -o magic magic.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 | -o thief thief.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 | -o game game.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 | -o easy easy.cpp -lm -std=c++14 -O2 -Wl,--stack=2147483647 |

 

## 三、注意事项 

1. 文件夹名、文件名(程序名和输入输出文件名)必须使用英文小写。
2. C/C++中函数main()的返回值类型必须是int,程序正常结束时的返回值必须是0。
3. 统一评测时采用的机器配置为：windows下lemon评测。
4. 请尽力优化，会收获更多的部分得分。
5. **AK 了不要大声喧哗，没AK也不要**。

# 大魔法师(magic)

## 题目描述

大魔法师小 L 制作了 $n$ 个魔力水晶球，每个水晶球有水、火、土三个属性的能量值。小 L 把这 $n$ 个水晶球在地上从前向后排成一行，然后开始今天的魔法表演。

我们用 $A_i,B_i,C_i$ 分别表示从前向后第 $i$ 个水晶球（下标从 $1$ 开始）的水、火、土的能量值。

小 L 计划施展 $m$ 次魔法。每次，他会选择一个区间 $[l,r]$，然后施展以下 $3$ 大类、$7$ 种魔法之一：

1. 魔力激发：令区间里每个水晶球中**特定属性**的能量爆发，从而使另一个**特定属性**的能量增强。具体来说，有以下三种可能的表现形式：

	- 火元素激发水元素能量：令 $A_i=A_i+B_i$。
	- 土元素激发火元素能量：令 $B_i=B_i+C_i$。
	- 水元素激发土元素能量：令 $C_i=C_i+A_i$。
	
 **需要注意的是，增强一种属性的能量并不会改变另一种属性的能量，例如 $A_i=A_i+B_i$ 并不会使 $B_i$ 增加或减少。**

2. 魔力增强：小 L 挥舞法杖，消耗自身 $v$ 点法力值，来改变区间里每个水晶球的**特定属性**的能量。具体来说，有以下三种可能的表现形式：

	- 火元素能量定值增强：令 $A_i=A_i+v$。
	- 水元素能量翻倍增强：令 $B_i=B_i\times v$。
	- 土元素能量吸收融合：令 $C_i=v$。
3. 魔力释放：小 L 将区间里所有水晶球的能量聚集在一起，融合成一个新的水晶球，然后送给场外观众。生成的水晶球每种属性的能量值等于区间内所有水晶球对应能量值的代数和。**需要注意的是，魔力释放的过程不会真正改变区间内水晶球的能量。**

值得一提的是，小 L 制造和融合的水晶球的原材料都是定制版的 OI 工厂水晶，所以这些水晶球有一个能量阈值 $998244353$。当水晶球中某种属性的能量值大于等于这个阈值时，能量值会自动对阈值取模，从而避免水晶球爆炸。

小 W 为小 L（唯一的）观众，围观了整个表演，并且收到了小 L 在表演中融合的每个水晶球。小 W 想知道，这些水晶球蕴涵的三种属性的能量值分别是多少。

## 输入格式

从标准输入读入数据。

我们将上述的 $7$ 种魔法，从上到下依次标号为 $1\sim7$。

输入的第一行包含一个整数 $n$，表示水晶球个数。

接下来 $n$ 行，每行空格隔开的 $3$ 个整数，其中第 $i$ 行的三个数依次表示 $A_i,B_i,C_i$。

接下来一行包含一个整数 $m$，表示施展魔法的次数。

接下来 $m$ 行，每行 $3$ 或 $4$ 个数，格式为 `opt l r (v)`。其中 `opt` 表示魔法的编号，$l,r$ 表示施展魔法的区间（保证有 $l\le r$）。特别地，如果施展 $4\sim6$ 号魔法（魔力增强），则还有一个整数 $v$，表示小 L 消耗的法力值。

## 输出格式

输出到标准输出。

对每个 $7$ 号魔法（魔力释放），输出一行、空格隔开的 $3$ 个整数 `a b c`，分别表示此次融合得到的水晶球的水、火、土元素能量值。

## 样例

#### 样例1输入

```
2
2 3 3
6 6 6
4
7 1 2
1 1 2
4 1 2 3
7 1 2
```

#### 样例1输出

```
8 9 9
23 9 9
```

#### 样例1解释

以下展示每次施展魔法后，两个水晶球内的能量：
```
(2, 3, 3) (6, 6, 6)
(5, 3, 3) (12, 6, 6)
(8, 3, 3) (15, 6, 6)
(8, 3, 3) (15, 6, 6)
```

## 数据范围

对于所有数据，满足：$1\le n,m\le 2.5\times 10^5$，$0\le A_i,B_i,C_i,v< 998244353$

| 测试点编号 | 特殊限制 |
|:-:|:-:|
| $1\sim 6$ | $n,m\le 10^3$ |
| $7\sim 9$ | 只存在操作 $\{4,5,6,7\}$ |
| $10\sim 12$ | 只存在操作 $\{1,2,3\}$ |
| $13\sim 15$ | $n,m\le 10^5$ |
| $16\sim 20$ | $n,m\le 2.5\times 10^5$ |

# 盗道(thief)

## 题目描述

库纳（Kuna）是克罗地亚的货币单位。

海岸线上有一排房子，从西到东标号 $1\sim n$。第 $i$ 座房子内有 $a_i$ 库纳。

有 $m$ 个窃贼要行窃。第 $i$ 个窃贼初始囊中有 $c_i$ 库纳，他将依次对编号为 $l_i,l_i+1,\cdots, r_i$ 的房子行窃。

盗亦有道，窃贼们践行盗之道。当窃贼对编号为 $j$ 的房子行窃时，令他囊中有 $k$ 库纳：

- 若 $k\lt a_j$，则窃贼将 $1$ 库纳收入囊中，即 $k\gets k+1$；
- 若 $k=a_j$，无事发生；
- 若 $k\gt a_j$，则窃贼拿出 $1$ 库纳赠给房主，即 $k\gets k-1$。

对于每个窃贼，求出他最后囊中会有多少库纳。

需要注意的是，**每个窃贼的行窃是独立的，不互相影响**。换句话说，可以认为一个窃贼行窃结束后，（在下一个窃贼行窃前）房子会恢复到初始状态。

## 输入格式

第一行，两个正整数 $n,m$;

第二行，$n$ 个非负整数 $a_1,a_2,\cdots,a_n$;

接下来 $m$ 行，每行三个整数 $l_i,r_i,c_i$。

## 输出格式

对于每个询问，输出一行一个整数表示答案。

## 样例

#### 样例1输入

```
10 3
3 5 5 4 3 6 10 0 4 7
2 10 9
6 6 2
2 8 4
```

#### 样例1输出

```
6
3
4
```

#### 样例2输入

```
8 5
2 3 0 9 2 6 0 6
5 6 8
3 4 7
3 8 8
8 8 7
6 7 9
```

#### 样例2输出

```
6
7
6
6
7
```

## 数据范围

对于全部数据，满足 $1\le n,m\le 5\times 10^5$，$0\le a_i,c_i\le 10^6$，$1\le l_i\le r_i\le n$。

| 测试点编号 | 约束 |
| :---: | :---: |
| $1\sim 6$ | $n,m\le 10^3$ |
| $7\sim 10$ | $l_i=1$ |
| $11\sim 14$ | $a_i,c_i\le 20$ |
| $15\sim 17$ | $n,m\le 2\times 10^5$ |
| $18\sim 20$ | 无特殊限制 |

# Alice 和 Bob 又在玩游戏(game)

## 题目背景

> “你知道么，对于公平组合游戏，可以计算它的 $SG$ 函数。”
> 
> “什么东西？”
>
> “如果 $SG$ 函数不为 $0$ 说明先手有必胜策略，否则后手必胜策略。”
>
> “？”
>
> “如果一个游戏是在若干个相互独立的游戏 $A_1,A_2,\dots A_n$ 组合而成，每次操作为选择其中一个游戏操作一次，那么这个游戏的 $SG$ 函数就是这 $n$ 个游戏的 $SG$ 函数的异或和；一个游戏状态的 $SG$ 函数是其所有后继状态的 $SG$ 函数的 $\operatorname{mex}$，也就是最小的没有出现的非负整数值。”
>
> “为什么要和我说这些？”
>
> “没什么，就是告诉你而已。”
>
> “？”

## 题目描述

在被先后两任新生舞会舞伴以当天有事为由抛弃后，Bronya18C 决定加训算法竞赛。

这天 Bronya18C 在加训的时候遇到了这样一道题目：

给定一个有根树森林，两位玩家 Bronya18C 和 Bronya19C 轮流操作，Bronya18C 先手。

每次操作开始时，若森林为空，则当前玩家输掉游戏。

否则当前玩家需要选择一个节点 $u$，并删去 $u$ 所在的连通块的根 $r$ 到节点 $u$ 的唯一简单路径上的所有节点，以及与这些节点相邻的边。

操作后新产生的连通块的根为该连通块中原先到 $r$ 距离最小的节点。

显然 Bronya18C 和 Bronya19C 都绝顶聪明，你需要判断当两位玩家都采取最优策略时谁会获胜。

由于这是 IOI 赛制，为了证明你真的会做这道题，你还需要求出初始局面的 SG 值。

退役太久的 Bronya18C 发现自己已经不会写代码了，请你帮帮他！

## 输入格式

第一行输入一个正整数 $T$ 表示有根树森林的连通块个数。

接下来依次输入 $T$ 棵有根树，每棵有根树按如下格式输入：

第一行输入一个正整数 $n$ 表示有根树的节点数，节点由 $1$ 到 $n$ 编号，有根树以节点 $1$ 为根。

若 $n\neq 1$，接下来一行输入 $n−1$ 个正整数，第 $i$ 个正整数表示节点 $i+1$ 在有根树上的父亲 $p_{i+1}$。

## 输出格式

输出一行一个整数表示初始局面的 SG 值。

## 样例

#### 样例1输入

```
10
1
2
1
3
1 2
4
1 1 2
5
1 2 2 1
6
1 1 3 3 5
7
1 2 1 3 5 6
8
1 1 2 2 3 3 5
9
1 2 3 3 2 3 5 6
10
1 2 3 3 2 3 2 6 1
```

#### 样例1输出

```
9
```

## 数据范围

对于所有数据，满足：$1\le \sum n\le 2\times 10^6$，$1\le p_i<i$。

| 测试点编号 | 特殊性质 | 空间限制 |
| :---: | :---: | :---: |
| $1\sim 4$ | $\sum n\le 20$ | 512MB |
| $5\sim 8$ | $\sum n\le 3000$ | 512MB |
| $9\sim 12$ | $\sum n\le 10^4$ | 512MB |
| $13\sim 16$ | 无 | 512MB |
| $17\sim 20$ | 无 | 128MB |

# 简单数据结构(easy)

## 题目描述

小 D 是一位数据结构大师，他特别喜欢研究形式简单的数据结构，今天他想到了这样一道题目：

你有一个长度为 $n$ 的序列 $a$，下面你要进行 $q$ 次修改或询问。

1. 给定 $v$，将所有 $a_i$ 变为 $\min(a_i, v)$。
2. 将所有 $a_i$ 变为 $a_i + i$。
3. 给定 $l, r$，询问 $\sum_{i=l}^r a_i$。

顶级数据结构大师小 D 轻松的解决了这个问题，现在他打算来考考即将参加 IOI2022 的你，相信你也可以轻松解决这个问题。

## 输入格式。

第一行两个正整数 $n, q$，表示序列的长度与修改/询问的个数。

下面一行 $n$ 个整数 $a_i$，表示初始序列 $a$。

下面 $q$ 行，每行第一个正整数 $op_i$ 表示第 $i$ 次修改/询问的类型。

若 $op_i = 1$，则下面紧跟一个整数 $v_i$，表示进行一次修改 1。

若 $op_i = 2$，则表示进行一次修改 2。

若 $op_i = 3$，则下面紧跟两个正整数 $l_i, r_i$，表示进行一次询问 3。

## 输出格式

若干行，每行一个整数表示答案。

## 样例

#### 样例1输入

```
15 15
6 14 14 6 3 6 4 13 10 3 12 5 11 9 6
1 9
1 2
2
2
2
1 11
3 4 6
2
1 6
2
1 9
1 11
1 11
3 4 4
3 2 13
```

#### 样例1输出

```
33
9
107
```

## 数据范围

对于所有数据， $1 \leq n, q \leq 2 \times 10^5$，$0 \leq a_i, v_i \leq 10^{12}$。

| 子任务编号 | 子任务分值 | $n,q$ | 特殊性质 |
| :---: | :---: | :---: | :---: |
| $1$ | $10$ | $5000$ | |
| $2$ | $20$ | $200000$ | A |
| $3$ | $15$ | $200000$ | $op_i\neq 2$ |
| $4$ | $55$ | $200000$ | |

性质 A 为：$a_i, v_i$ 在 $[0, 10^{12}]$ 随机生成，$op_i$ 在 $[1, 3]$ 随机生成，$[l_i, r_i]$ 在所有可行区间随机生成。